<html>
  <head>
  </head>
  <body>

    <script type="application/javascript">

    const inputcontainer = document.createElement('div');
    const chatcontainer = document.createElement('div');



       
        chatcontainer.style.flexGrow = "1";
        chatcontainer.style.flexBasis = "0";
        chatcontainer.style.overflowY = "scroll";
        chatcontainer.style.overflowX = "hidden";
        

        inputcontainer.style.background = "purple";
        inputcontainer.style.flexBasis = "100px";

        document.body.append(chatcontainer);
        document.body.append(inputcontainer);

        document.body.style.display = "flex";
        document.body.style.height = "100vh";
        document.body.style.flexDirection = "column";
        document.body.style.margin = "0";
        





    const ul = document.createElement('ul');
    chatcontainer.append(ul);
    const t = document.createElement('textarea');
    inputcontainer.append(t);
    const b = document.createElement('button');
    b.append('SEND');
    inputcontainer.append(b);


    const btn_drkmode = document.createElement('button');
    btn_drkmode.textContent = 'Dark Mode';
inputcontainer.append(btn_drkmode, document.body.firstChild);



const toggleDarkMode = () => {
    theme = theme === "white" ? "black" : "white";
    setTheme(theme);
};

btn_drkmode.addEventListener('click', toggleDarkMode);



const setTheme = (theme) => {
    console.log(theme);
    if (theme === 'black') {
        localStorage.setItem("Theme", theme);
        chatcontainer.style.background = 'white';
        ul.style.color = "black";
        inputcontainer.style.background = "purple";
        btn_drkmode.textContent = 'Toggle Dark Mode';
    } else {
        localStorage.setItem("Theme", theme);
        chatcontainer.style.background = 'black';
        ul.style.color = "white";
        inputcontainer.style.background = "purple";
        btn_drkmode.textContent = 'Toggle Light Mode';
    }
};

let theme = localStorage.getItem("Theme") || "white";
setTheme(theme);
    

    btn_drkmode.addEventListener('click', toggleDarkMode);

    const getMessages = async () => {
      const response = await fetch('https://chat.tiburoncin.lat/messages');
      const messages = await response.json();
       messages.reverse().forEach((message) => {
        const li = document.createElement('li');
        li.append(`${message.username}: ${message.message}`);
        ul.append(li);
        
      });
      chatcontainer.scrollTop = chatcontainer.scrollHeight;
    };


     const postMessage = async () => {
      console.log(t.value);
      const body = {
        username: 'Dubon',
        message: t.value, 
      };



      const response = await fetch('https://chat.tiburoncin.lat/messages',
      {
        method: 'POST',
        body: JSON.stringify(body)
      });
      ul.innerHTML = "";
      getMessages();
    };


    b.addEventListener('click', postMessage);
    
    getMessages();
    
    </script>
  </body>
</html>
